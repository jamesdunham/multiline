---
output:
  md_document:
    variant: markdown_github
---

```{r, knitr-options, echo = FALSE}
# rmarkdown::render("README.Rmd")
knitr::opts_chunk$set(
  echo = TRUE,
  collapse = TRUE,
  comment = "#>",
  fig.path = "README/",
  cache = FALSE)
```

## Introduction

multiline is an R package for reading data from multiline fixed-width-formatted
(FWF) files. This format is like that of typical FWF files, except that data for
a given observation wraps after some number of columns.

Digitized punch card data are often found in multiline FWF format. If data for
each observation exceeded the horizontal space on a card (conventionally 80
columns), additional decks of cards were used. When digitized, their rows were
were interleaved so that data for each observation would appear in consecutive
rows, one per card.

## Installation

Install from GitHub with devtools:

```{r, eval = FALSE}
if (!require(devtools, quietly = TRUE)) install.packages("devtools")
devtools::install_github("jamesdunham/multiline")
```

## Background

Consider the following multiline FWF (MFWF) data. As with FWF data, parsing
requires the column positions of each field. But because observations wrap
across lines, parsing also requires the *line* position of each field.

```
123456789
789
123456789
789
```

If `field1` appears in columns 1-9 of line 1 and `field2` is in columns 1-3 of
line 2, then the data give two observations with identical values for each
field.

Thus another way to see MFWF data is as a "long" table (i.e., with observations
spanning rows) whose unique identifiers are implicit. Below these observation
identifiers are in parentheses.

```
123456789  (obs. 1)
789        (obs. 1)
123456789  (obs. 2)
789        (obs. 2)
```

In a MFWF file, lines appear whether or not they contain data. Below, `field2`
were missing for the first observation. The parentheses give line numbers.

```
123456789  (line 1)
           (line 2)
123456789  (line 1)
789        (line 2)
```

## Usage

Specify the column and line positions of each field in a table with four
columns: `start` and `end` column numbers, `line` number, and field `name`.
Example:

# TODO: package example data
> https://www.ropercenter.cornell.edu/CFIDE/cf/action/catalog/abstract.cfm?type=&start=&id=&archno=USRCOM1940-012&abstract=

The [`fwf_` functions](http://readr.tidyverse.org/reference/read_fwf.html) from
[`readr`](http://readr.tidyverse.org/index.html) make creating a positions
table easy.

For example, if `field1` is in
line 1, columns 1-9, and `field2` is in line 2, columns 1-3, then:

```{r}
library(readr)
library(dplyr)
positions = list(
  fwf_positions(start = 1, end = 9, col_names = 'field1'),
  fwf_positions(start = 1, end = 3, col_names = 'field2')) %>%
  bind_rows()
positions
```

Here's some MFWF data:
# TODO: package example data

```{r}
d <- "123456789\n789\n123456789\n789"
```

The result is a tidy table.

```{r}
tidy <- read_multiline(d, lines = 2, positions)
tidy
```

