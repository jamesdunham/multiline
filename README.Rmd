---
output:
  md_document:
    variant: markdown_github
---

```{r, knitr-options, echo = FALSE}
# rmarkdown::render("README.Rmd")
knitr::opts_chunk$set(
  echo = TRUE,
  collapse = TRUE,
  comment = "#>",
  fig.path = "README/",
  cache = FALSE)
```

# multiline

multiline is an R package for reading data from multiline fixed-width-formatted
(FWF) files. This format is like that of typical FWF files, except that data for
a given observation wraps after some number of columns.

## Background

Consider the following multiline FWF (MFWF) data. As with FWF data, parsing
requires the column positions of each field. But furthermore, we need the line
position of each field.

```
123456789
789
123456789
789
```

If `field1` appears in columns 1-9 of line 1 and `field2` is in columns 1-3 of
line 2, then the data give two observations with identical values for each
field.

Thus another way to see MFWF data is as a "long" table (i.e., with observations
spanning rows) whose unique identifiers are implicit. The updated example below
shows these observation identifiers in parentheses.

```
123456789  (1)
789        (1)
123456789  (2)
789        (2)
```

Because line numbers in MFWF data are inferred (just as column numbers in FWF
data), lines must appear whether or not they contain data. The updated example
below shows how the data would look if `field2` were missing for observation
1. The parentheses give line numbers.

```
123456789  (1)
           (2)
123456789  (1)
789        (2)
```


## Usage

We can represent field positions in a dataframe whose columns give names, line
positions, and column positions. If `field1` is in line 1, columns 1-9, and
`field2` is in line 2, columns 1-3, then:

```
positions <- data.frame(field = c("field1", "field2"), line = c(1, 2), col_start
  = c(1, 1), col_end = c(9, 3))
positions
```

Given the data:

```{r}
d <- "123456789\n789\n123456789\n789"
cat(d)
```

`read_mfwf()` returns a tidy table with observations in rows and fields in
columns.

```{r}
tidy <- read_multiline(d, positions)
tidy
```


## Installation

Install from GitHub with devtools:

```{r, eval = FALSE}
# install.packagaes("devtools")
devtools::install_github("jamesdunham/multiline")
```

